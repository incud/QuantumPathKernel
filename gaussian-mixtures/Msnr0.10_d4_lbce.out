Welcome
11/04/2022 14:18:45 - Experiment D=4, snr=0.1, N=16, loss=bce, MAX_LAYERS=20, MAX_EPOCHS=1000
Loading existing training set

11/04/2022 14:18:45 - Creating QNN (1 layers)
11/04/2022 14:18:45 - Start training
....................
11/04/2022 14:22:59 - Start NTK PK calculation
11/04/2022 14:24:20 - End QNN

11/04/2022 14:24:20 - Creating QNN (2 layers)
11/04/2022 14:24:20 - Start training
....................
11/04/2022 14:28:55 - Start NTK PK calculation
11/04/2022 14:32:01 - End QNN

11/04/2022 14:32:01 - Creating QNN (3 layers)
11/04/2022 14:32:01 - Start training
....................
11/04/2022 14:37:49 - Start NTK PK calculation
11/04/2022 14:41:25 - End QNN

11/04/2022 14:41:25 - Creating QNN (4 layers)
11/04/2022 14:41:25 - Start training
....................
11/04/2022 14:48:34 - Start NTK PK calculation
11/04/2022 14:57:42 - End QNN

11/04/2022 14:57:42 - Creating QNN (5 layers)
11/04/2022 14:57:42 - Start training
....................
11/04/2022 15:06:10 - Start NTK PK calculation
11/04/2022 15:14:25 - End QNN

11/04/2022 15:14:25 - Creating QNN (6 layers)
11/04/2022 15:14:25 - Start training
....................
11/04/2022 15:24:09 - Start NTK PK calculation
11/04/2022 15:37:06 - End QNN

11/04/2022 15:37:06 - Creating QNN (7 layers)
11/04/2022 15:37:06 - Start training
....................
11/04/2022 15:48:14 - Start NTK PK calculation
11/04/2022 16:00:58 - End QNN

11/04/2022 16:00:58 - Creating QNN (8 layers)
11/04/2022 16:00:58 - Start training
....................
11/04/2022 16:13:36 - Start NTK PK calculation
11/04/2022 16:27:53 - End QNN

11/04/2022 16:27:53 - Creating QNN (9 layers)
11/04/2022 16:27:53 - Start training
....................
11/04/2022 16:42:01 - Start NTK PK calculation
11/04/2022 17:03:36 - End QNN

11/04/2022 17:03:36 - Creating QNN (10 layers)
11/04/2022 17:03:36 - Start training
....................
11/04/2022 17:19:05 - Start NTK PK calculation
11/04/2022 17:29:44 - End QNN

11/04/2022 17:29:44 - Creating QNN (11 layers)
11/04/2022 17:29:44 - Start training
....................
11/04/2022 17:46:39 - Start NTK PK calculation
11/04/2022 18:06:51 - End QNN

11/04/2022 18:06:51 - Creating QNN (12 layers)
11/04/2022 18:06:51 - Start training
....................
11/04/2022 18:25:15 - Start NTK PK calculation
11/04/2022 18:40:48 - End QNN

11/04/2022 18:40:48 - Creating QNN (13 layers)
11/04/2022 18:40:48 - Start training
....................
11/04/2022 19:00:38 - Start NTK PK calculation
11/04/2022 19:17:42 - End QNN

11/04/2022 19:17:42 - Creating QNN (14 layers)
11/04/2022 19:17:42 - Start training
....................
11/04/2022 19:38:53 - Start NTK PK calculation
11/04/2022 19:58:17 - End QNN

11/04/2022 19:58:17 - Creating QNN (15 layers)
11/04/2022 19:58:17 - Start training
....................
11/04/2022 20:21:08 - Start NTK PK calculation
11/04/2022 20:41:35 - End QNN

11/04/2022 20:41:35 - Creating QNN (16 layers)
11/04/2022 20:41:35 - Start training
....................
11/04/2022 21:05:55 - Start NTK PK calculation
11/04/2022 21:29:22 - End QNN

11/04/2022 21:29:22 - Creating QNN (17 layers)
11/04/2022 21:29:22 - Start training
....................
11/04/2022 21:55:11 - Start NTK PK calculation
11/04/2022 22:37:31 - End QNN

11/04/2022 22:37:31 - Creating QNN (18 layers)
11/04/2022 22:37:31 - Start training
....................2022-04-11 23:34:17.693384: E external/org_tensorflow/tensorflow/compiler/xla/pjrt/pjrt_stream_executor_client.cc:2140] Execution of replica 0 failed: INTERNAL: Failed to load in-memory CUBIN: CUDA_ERROR_OUT_OF_MEMORY: out of memory

11/04/2022 23:04:55 - Start NTK PK calculation
11/04/2022 23:34:06 - End QNN

11/04/2022 23:34:06 - Creating QNN (19 layers)
11/04/2022 23:34:06 - Start training
Traceback (most recent call last):
  File "/data/mgrossi/QuantumPathKernel/gaussian-mixtures/gaussian-mixture-jax.py", line 957, in <module>
    main()
  File "/data/mgrossi/anaconda_install/envs/pennylane/lib/python3.9/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
  File "/data/mgrossi/anaconda_install/envs/pennylane/lib/python3.9/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
  File "/data/mgrossi/anaconda_install/envs/pennylane/lib/python3.9/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
  File "/data/mgrossi/anaconda_install/envs/pennylane/lib/python3.9/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
  File "/data/mgrossi/anaconda_install/envs/pennylane/lib/python3.9/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
  File "/data/mgrossi/QuantumPathKernel/gaussian-mixtures/gaussian-mixture-jax.py", line 917, in experiment
    run_qnns(d, snr, n, loss, MAX_LAYERS=layers, MAX_EPOCHS=epochs, directory_dataset=directoryds)
  File "/data/mgrossi/QuantumPathKernel/gaussian-mixtures/gaussian-mixture-jax.py", line 188, in run_qnns
    specs, df, ntk_grams, ntk_gram_indexes, pk_gram = run_qnn(X, Y, loss, layers=layers, epochs=MAX_EPOCHS)
  File "/data/mgrossi/QuantumPathKernel/gaussian-mixtures/gaussian-mixture-jax.py", line 162, in run_qnn
    specs, df = train_qnn(X, Y, qnn, loss, n_params=2*layers, epochs=epochs)
  File "/data/mgrossi/QuantumPathKernel/gaussian-mixtures/gaussian-mixture-jax.py", line 110, in train_qnn
    cost, grad_circuit = jax.value_and_grad(lambda w: calculate_cost(X, Y, qnn, w, N))(params)
  File "/data/mgrossi/anaconda_install/envs/pennylane/lib/python3.9/site-packages/jax/_src/traceback_util.py", line 162, in reraise_with_filtered_traceback
    return fun(*args, **kwargs)
  File "/data/mgrossi/anaconda_install/envs/pennylane/lib/python3.9/site-packages/jax/_src/api.py", line 952, in value_and_grad_f
    ans, vjp_py = _vjp(f_partial, *dyn_args, reduce_axes=reduce_axes)
  File "/data/mgrossi/anaconda_install/envs/pennylane/lib/python3.9/site-packages/jax/_src/api.py", line 2408, in _vjp
    out_primal, out_vjp = ad.vjp(
  File "/data/mgrossi/anaconda_install/envs/pennylane/lib/python3.9/site-packages/jax/interpreters/ad.py", line 119, in vjp
    out_primals, pvals, jaxpr, consts = linearize(traceable, *primals)
  File "/data/mgrossi/anaconda_install/envs/pennylane/lib/python3.9/site-packages/jax/interpreters/ad.py", line 106, in linearize
    jaxpr, out_pvals, consts = pe.trace_to_jaxpr(jvpfun_flat, in_pvals)
  File "/data/mgrossi/anaconda_install/envs/pennylane/lib/python3.9/site-packages/jax/_src/profiler.py", line 206, in wrapper
    return func(*args, **kwargs)
  File "/data/mgrossi/anaconda_install/envs/pennylane/lib/python3.9/site-packages/jax/interpreters/partial_eval.py", line 592, in trace_to_jaxpr
    jaxpr, (out_pvals, consts, env) = fun.call_wrapped(pvals)
  File "/data/mgrossi/anaconda_install/envs/pennylane/lib/python3.9/site-packages/jax/linear_util.py", line 166, in call_wrapped
    ans = self.f(*args, **dict(self.params, **kwargs))
  File "/data/mgrossi/QuantumPathKernel/gaussian-mixtures/gaussian-mixture-jax.py", line 110, in <lambda>
    cost, grad_circuit = jax.value_and_grad(lambda w: calculate_cost(X, Y, qnn, w, N))(params)
  File "/data/mgrossi/QuantumPathKernel/gaussian-mixtures/gaussian-mixture-jax.py", line 79, in calculate_bce_cost
    yp = (qnn(x, params) + 1)/2 + epsilon  # 1 label -> 1; - label -> 0
  File "/data/mgrossi/anaconda_install/envs/pennylane/lib/python3.9/site-packages/jax/_src/traceback_util.py", line 162, in reraise_with_filtered_traceback
    return fun(*args, **kwargs)
  File "/data/mgrossi/anaconda_install/envs/pennylane/lib/python3.9/site-packages/jax/_src/api.py", line 432, in cache_miss
    out_flat = xla.xla_call(
  File "/data/mgrossi/anaconda_install/envs/pennylane/lib/python3.9/site-packages/jax/core.py", line 1709, in bind
    return call_bind(self, fun, *args, **params)
  File "/data/mgrossi/anaconda_install/envs/pennylane/lib/python3.9/site-packages/jax/core.py", line 1721, in call_bind
    outs = top_trace.process_call(primitive, fun, tracers, params)
  File "/data/mgrossi/anaconda_install/envs/pennylane/lib/python3.9/site-packages/jax/interpreters/ad.py", line 331, in process_call
    result = call_primitive.bind(f_jvp, *primals, *nonzero_tangents, **new_params)
  File "/data/mgrossi/anaconda_install/envs/pennylane/lib/python3.9/site-packages/jax/core.py", line 1709, in bind
    return call_bind(self, fun, *args, **params)
  File "/data/mgrossi/anaconda_install/envs/pennylane/lib/python3.9/site-packages/jax/core.py", line 1721, in call_bind
    outs = top_trace.process_call(primitive, fun, tracers, params)
  File "/data/mgrossi/anaconda_install/envs/pennylane/lib/python3.9/site-packages/jax/interpreters/partial_eval.py", line 207, in process_call
    out = primitive.bind(f, *in_consts, **const_params)
  File "/data/mgrossi/anaconda_install/envs/pennylane/lib/python3.9/site-packages/jax/core.py", line 1709, in bind
    return call_bind(self, fun, *args, **params)
  File "/data/mgrossi/anaconda_install/envs/pennylane/lib/python3.9/site-packages/jax/core.py", line 1721, in call_bind
    outs = top_trace.process_call(primitive, fun, tracers, params)
  File "/data/mgrossi/anaconda_install/envs/pennylane/lib/python3.9/site-packages/jax/core.py", line 614, in process_call
    return primitive.impl(f, *tracers, **params)
  File "/data/mgrossi/anaconda_install/envs/pennylane/lib/python3.9/site-packages/jax/_src/dispatch.py", line 145, in _xla_call_impl
    out = compiled_fun(*args)
  File "/data/mgrossi/anaconda_install/envs/pennylane/lib/python3.9/site-packages/jax/_src/dispatch.py", line 444, in _execute_compiled
    out_bufs = compiled.execute(input_bufs)
jax._src.traceback_util.UnfilteredStackTrace: RuntimeError: INTERNAL: Failed to load in-memory CUBIN: CUDA_ERROR_OUT_OF_MEMORY: out of memory

The stack trace below excludes JAX-internal frames.
The preceding is the original exception that occurred, unmodified.

--------------------

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/data/mgrossi/QuantumPathKernel/gaussian-mixtures/gaussian-mixture-jax.py", line 957, in <module>
    main()
  File "/data/mgrossi/anaconda_install/envs/pennylane/lib/python3.9/site-packages/click/core.py", line 1128, in __call__
    return self.main(*args, **kwargs)
  File "/data/mgrossi/anaconda_install/envs/pennylane/lib/python3.9/site-packages/click/core.py", line 1053, in main
    rv = self.invoke(ctx)
  File "/data/mgrossi/anaconda_install/envs/pennylane/lib/python3.9/site-packages/click/core.py", line 1659, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
  File "/data/mgrossi/anaconda_install/envs/pennylane/lib/python3.9/site-packages/click/core.py", line 1395, in invoke
    return ctx.invoke(self.callback, **ctx.params)
  File "/data/mgrossi/anaconda_install/envs/pennylane/lib/python3.9/site-packages/click/core.py", line 754, in invoke
    return __callback(*args, **kwargs)
  File "/data/mgrossi/QuantumPathKernel/gaussian-mixtures/gaussian-mixture-jax.py", line 917, in experiment
    run_qnns(d, snr, n, loss, MAX_LAYERS=layers, MAX_EPOCHS=epochs, directory_dataset=directoryds)
  File "/data/mgrossi/QuantumPathKernel/gaussian-mixtures/gaussian-mixture-jax.py", line 188, in run_qnns
    specs, df, ntk_grams, ntk_gram_indexes, pk_gram = run_qnn(X, Y, loss, layers=layers, epochs=MAX_EPOCHS)
  File "/data/mgrossi/QuantumPathKernel/gaussian-mixtures/gaussian-mixture-jax.py", line 162, in run_qnn
    specs, df = train_qnn(X, Y, qnn, loss, n_params=2*layers, epochs=epochs)
  File "/data/mgrossi/QuantumPathKernel/gaussian-mixtures/gaussian-mixture-jax.py", line 110, in train_qnn
    cost, grad_circuit = jax.value_and_grad(lambda w: calculate_cost(X, Y, qnn, w, N))(params)
  File "/data/mgrossi/QuantumPathKernel/gaussian-mixtures/gaussian-mixture-jax.py", line 110, in <lambda>
    cost, grad_circuit = jax.value_and_grad(lambda w: calculate_cost(X, Y, qnn, w, N))(params)
  File "/data/mgrossi/QuantumPathKernel/gaussian-mixtures/gaussian-mixture-jax.py", line 79, in calculate_bce_cost
    yp = (qnn(x, params) + 1)/2 + epsilon  # 1 label -> 1; - label -> 0
RuntimeError: INTERNAL: Failed to load in-memory CUBIN: CUDA_ERROR_OUT_OF_MEMORY: out of memory
